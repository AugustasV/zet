# devcontainer.yml
name: Go with Keg
build:
  dockerfile: Dockerfile
extensions:
  - golang.go

# Use the official Go image as the base
# and install keg using Go's package manager
dockerfile: |
  FROM alpine:3.16
  
  RUN apk add --no-cache git go=1.18.7-r0 vim bash
  
  ENV GOROOT /usr/lib/go
  ENV GOPATH /go
  ENV PATH /go/bin:$PATH
  # ENV KEG_CURRENT=zet keg "$@"

  # Install keg
  RUN go install github.com/rwxrob/keg/cmd/keg@latest

  # Set the default working directory
  WORKDIR /zet

  # Configure Git
  RUN git config --global user.email "$GIT_USER_EMAIL" && \
      git config --global user.name "$GIT_USER_NAME" && \
      git config --global credential.helper store

  # Copy the repository into the container
  COPY . /zet
  CMD ["sh"]

containerEnv:
  - name: GIT_USER_EMAIL
    value: "${localEnv:GIT_USER_EMAIL}"
  - name: GIT_USER_NAME
    value: "${localEnv:GIT_USER_NAME}"

command: sleep infinity
